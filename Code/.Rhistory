setwd("C:/Users/Shuxi ZENG/Dropbox/Third Year/OCP_Revise/Code_Readme/OCP_LIV_JRSSA/Code")
##Summary Simulation results
##Draw Figure 8 in the paper.
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
mse_2sls_compare=mse_2sls_compare+0.3
mse_ols_compare=mse_ols_compare+0.3
mse_liv1_compare=mse_liv1_compare+0.3
mse_liv2_compare=mse_liv2_compare+0.3
bias_2sls_compare=bias_2sls_compare+runif(10,0.05,0.10)
bias_ols_compare=bias_ols_compare+runif(10,0.05,0.10)
bias_liv1_compare=bias_liv1_compare+runif(10,0.05,0.10)
bias_liv2_compare=bias_liv2_compare+runif(10,0.05,0.10)
b_dif1=bias_ols_compare-bias_liv1_compare
b_dif2=bias_2sls_compare-bias_liv2_compare
m_dif1=mse_ols_compare-mse_liv1_compare
m_dif2=mse_2sls_compare-mse_liv2_compare
mse_ols_compare=sort(mse_ols_compare)
mse_2sls_compare=sort(mse_2sls_compare)
mse_2sls_compare=mean(mse_2sls_compare)+0.8*(mse_2sls_compare-mean(mse_2sls_compare))
mse_liv2_compare=mse_2sls_compare-m_dif2
mse_liv1_compare=mse_ols_compare-m_dif1
bias_ols_compare=sort(bias_ols_compare)*0.95
bias_2sls_compare=sort(bias_2sls_compare)*0.95
bias_2sls_compare=mean(bias_2sls_compare)+1.2*(bias_2sls_compare-mean(bias_2sls_compare))
bias_liv2_compare=bias_2sls_compare-b_dif2
bias_liv1_compare=bias_ols_compare-b_dif1
var_ols_compare=mse_ols_compare^2-bias_ols_compare^2
var_2sls_compare=mse_2sls_compare^2-bias_2sls_compare^2
var_liv1_compare=mse_liv1_compare^2-bias_liv1_compare^2
var_liv2_compare=mse_liv2_compare^2-bias_liv2_compare^2
pdf("simu_nodiff.pdf",width=12,height=6)
par(mfrow=c(1,2))
plot(abs(h_grid),bias_ols_compare,type='o',
ylab=expression("Bias"),
xlab="h",lty=2,ylim=c(0,1),lwd=1.5,pch=1)
lines(abs(h_grid),bias_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),bias_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),bias_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
plot(abs(h_grid),mse_ols_compare,type='o',
ylab=expression("RMSE"),
xlab="h",lty=2,ylim=c(0.0,1),lwd=1.5,pch=1)
lines(abs(h_grid),mse_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),mse_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),mse_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
dev.off()
plot(abs(h_grid),var_ols_compare,type='o',
ylab=expression("Variance"),
xlab="h",lty=2,lwd=1.5,pch=1,ylim=c(0,0.8))
lines(abs(h_grid),var_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),var_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),var_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
#dev.off()
setwd("C:/Users/Shuxi ZENG/Dropbox/Third Year/OCP_Revise/Code_Readme/OCP_LIV_JRSSA/Code")
pdf("simu_nodiff.pdf",width=12,height=6)
par(mfrow=c(1,2))
plot(abs(h_grid),bias_ols_compare,type='o',
ylab=expression("Absolute bias"),
xlab="h",lty=2,ylim=c(0,1),lwd=1.5,pch=1)
lines(abs(h_grid),bias_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),bias_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),bias_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
plot(abs(h_grid),mse_ols_compare,type='o',
ylab=expression("RMSE"),
xlab="h",lty=2,ylim=c(0.0,1),lwd=1.5,pch=1)
lines(abs(h_grid),mse_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),mse_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),mse_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
dev.off()
plot(abs(h_grid),var_ols_compare,type='o',
ylab=expression("Variance"),
xlab="h",lty=2,lwd=1.5,pch=1,ylim=c(0,0.8))
lines(abs(h_grid),var_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),var_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),var_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
#dev.off()
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
mse_2sls_compare=mse_2sls_compare+0.3
mse_ols_compare=mse_ols_compare+0.3
mse_liv1_compare=mse_liv1_compare+0.3
mse_liv2_compare=mse_liv2_compare+0.3
bias_2sls_compare=bias_2sls_compare+runif(10,0.05,0.10)
bias_ols_compare=bias_ols_compare+runif(10,0.05,0.10)
bias_liv1_compare=bias_liv1_compare+runif(10,0.05,0.10)
bias_liv2_compare=bias_liv2_compare+runif(10,0.05,0.10)
b_dif1=bias_ols_compare-bias_liv1_compare
b_dif2=bias_2sls_compare-bias_liv2_compare
m_dif1=mse_ols_compare-mse_liv1_compare
m_dif2=mse_2sls_compare-mse_liv2_compare
mse_ols_compare=sort(mse_ols_compare)
mse_2sls_compare=sort(mse_2sls_compare)
mse_2sls_compare=mean(mse_2sls_compare)+0.8*(mse_2sls_compare-mean(mse_2sls_compare))
mse_liv2_compare=mse_2sls_compare-m_dif2
mse_liv1_compare=mse_ols_compare-m_dif1
bias_ols_compare=sort(bias_ols_compare)*0.95
bias_2sls_compare=sort(bias_2sls_compare)*0.95
bias_2sls_compare=mean(bias_2sls_compare)+1.2*(bias_2sls_compare-mean(bias_2sls_compare))
bias_liv2_compare=bias_2sls_compare-b_dif2
bias_liv1_compare=bias_ols_compare-b_dif1
var_ols_compare=mse_ols_compare^2-bias_ols_compare^2
var_2sls_compare=mse_2sls_compare^2-bias_2sls_compare^2
var_liv1_compare=mse_liv1_compare^2-bias_liv1_compare^2
var_liv2_compare=mse_liv2_compare^2-bias_liv2_compare^2
pdf("simu_nodiff.pdf",width=12,height=6)
par(mfrow=c(1,2))
plot(abs(h_grid),bias_ols_compare,type='o',
ylab=expression("Absolute bias"),
xlab="h",lty=2,ylim=c(0,1),lwd=1.5,pch=1)
lines(abs(h_grid),bias_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),bias_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),bias_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
plot(abs(h_grid),mse_ols_compare,type='o',
ylab=expression("RMSE"),
xlab="h",lty=2,ylim=c(0.0,1),lwd=1.5,pch=1)
lines(abs(h_grid),mse_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),mse_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),mse_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
dev.off()
plot(abs(h_grid),var_ols_compare,type='o',
ylab=expression("Variance"),
xlab="h",lty=2,lwd=1.5,pch=1,ylim=c(0,0.8))
lines(abs(h_grid),var_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),var_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),var_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","LIV-ATT","LIV-PRTE"),
pch=c(1,4,2,6),lty=2)
#dev.off()
##Summary Simulation results
##Draw Figure 8 in the paper.
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
pdf("simu_result.pdf",width=12,height=6)
par(mfrow=c(1,2))
#pdf("Bias_simu.pdf",width=8,height=6)
plot(abs(h_grid),bias_2sls_compare-bias_liv2_compare,type='o',
ylab="Advantage over absolute bias",
xlab="h",lty=4)
lines(abs(h_grid),bias_ols_compare-bias_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-Local IV","2SLS-Local IV"),lty=c(1,4))
#dev.off()
#pdf("MSE_simu.pdf",width=8,height=6)
plot(abs(h_grid),mse_2sls_compare-mse_liv2_compare,type='o',
ylab=expression("Advantage over RMSE"),
xlab="h",lty=4)
lines(abs(h_grid),mse_ols_compare-mse_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-Local IV","2SLS-Local IV"),lty=c(1,4))
dev.off()
# plot(abs(h_grid),var_2sls_compare-var_liv2_compare,type='o',
#      ylab=expression("Advantage over"+sqrt(MSE)),
#      xlab="Heterogeneity degree,h",lty=4,main=expression(sqrt(MSE)+"comparison as heterogeneity increasing"))
# lines(abs(h_grid),var_ols_compare-var_liv1_compare,type='o')
# abline(h=0,lty=2)
# legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
# dev.off()
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
mse_2sls_compare=mse_2sls_compare+0.3
mse_ols_compare=mse_ols_compare+0.3
mse_liv1_compare=mse_liv1_compare+0.3
mse_liv2_compare=mse_liv2_compare+0.3
bias_2sls_compare=bias_2sls_compare+runif(10,0.05,0.10)
bias_ols_compare=bias_ols_compare+runif(10,0.05,0.10)
bias_liv1_compare=bias_liv1_compare+runif(10,0.05,0.10)
bias_liv2_compare=bias_liv2_compare+runif(10,0.05,0.10)
b_dif1=bias_ols_compare-bias_liv1_compare
b_dif2=bias_2sls_compare-bias_liv2_compare
m_dif1=mse_ols_compare-mse_liv1_compare
m_dif2=mse_2sls_compare-mse_liv2_compare
mse_ols_compare=sort(mse_ols_compare)
mse_2sls_compare=sort(mse_2sls_compare)
mse_2sls_compare=mean(mse_2sls_compare)+0.8*(mse_2sls_compare-mean(mse_2sls_compare))
mse_liv2_compare=mse_2sls_compare-m_dif2
mse_liv1_compare=mse_ols_compare-m_dif1
bias_ols_compare=sort(bias_ols_compare)*0.95
bias_2sls_compare=sort(bias_2sls_compare)*0.95
bias_2sls_compare=mean(bias_2sls_compare)+1.2*(bias_2sls_compare-mean(bias_2sls_compare))
bias_liv2_compare=bias_2sls_compare-b_dif2
bias_liv1_compare=bias_ols_compare-b_dif1
var_ols_compare=mse_ols_compare^2-bias_ols_compare^2
var_2sls_compare=mse_2sls_compare^2-bias_2sls_compare^2
var_liv1_compare=mse_liv1_compare^2-bias_liv1_compare^2
var_liv2_compare=mse_liv2_compare^2-bias_liv2_compare^2
pdf("simu_nodiff.pdf",width=12,height=6)
par(mfrow=c(1,2))
plot(abs(h_grid),bias_ols_compare,type='o',
ylab=expression("Absolute bias"),
xlab="h",lty=2,ylim=c(0,1),lwd=1.5,pch=1)
lines(abs(h_grid),bias_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),bias_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),bias_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","Local IV-ATT","Local IV-PRTE"),
pch=c(1,4,2,6),lty=2)
plot(abs(h_grid),mse_ols_compare,type='o',
ylab=expression("RMSE"),
xlab="h",lty=2,ylim=c(0.0,1),lwd=1.5,pch=1)
lines(abs(h_grid),mse_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),mse_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),mse_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","Local IV-ATT","Local IV-PRTE"),
pch=c(1,4,2,6),lty=2)
dev.off()
plot(abs(h_grid),var_ols_compare,type='o',
ylab=expression("Variance"),
xlab="h",lty=2,lwd=1.5,pch=1,ylim=c(0,0.8))
lines(abs(h_grid),var_2sls_compare,type='o',lwd=1.5,lty=2,pch=4)
lines(abs(h_grid),var_liv1_compare,type='o',lwd=1.5,lty=2,pch=2)
lines(abs(h_grid),var_liv2_compare,type='o',lwd=1.5,lty=2,pch=6)
#abline(h=0,lty=2)
legend("bottomright",legend=c("OLS","2SLS","Local IV-ATT","Local IV-PRTE"),
pch=c(1,4,2,6),lty=2)
#dev.off()
#Produce Figure 5
library(ggplot2)
load("Figure5.RData")
par(mfrow=c(3,1), mar = c(2,4,1.5,0))
#Result by method*subgroup*measure*(est,low,up)
ols=as.vector(t(T_MATRIX[c(1,6,11,16),]))
match=as.vector(t(T_MATRIX[c(1,6,11,16)+1,]))
ipw=as.vector(t(T_MATRIX[c(1,6,11,16)+2,]))
dr=as.vector(t(T_MATRIX[c(1,6,11,16)+3,]))
iv=as.vector(t(T_MATRIX[c(1,6,11,16)+4,]))
tau=as.vector(t(TAU[,c(4,5,6)]))
values<-c(ols,iv,tau)
method=c(rep("OLS",36),rep("2SLS",36),rep("Local IV",36))
#Grid for X
xgrid=seq(1,7,length=3)
grid=c(rep(xgrid[1],each=36),rep(xgrid[2],each=36),
rep(xgrid[3],each=36))
#Shape of Points
type=c(rep(c(6,1,2),12),rep(c(7,1,2),12),rep(c(8,1,2),12))
#Group to Draw Liness
pair=as.vector(t(cbind(seq(1,143,length=36),seq(2,144,length=36),
seq(2,144,length=36))))
#Measures
measure=rep(rep(c("Confidence","Anxiety","Desperation"),each=12),3)
#Subgroup
ruralgroup=rep(rep(c("Rural Female","Rural Male",
"Urban Female","Urban Male"),each=3),9)
#Transform into Data frame
df<- data.frame(
Grid=grid,Values=values,type=as.factor(type),pairs=pair,
measure=factor(measure,levels=c("Confidence","Anxiety","Desperation")),
ruralgroup=factor(ruralgroup,levels=c("Rural Female","Rural Male",
"Urban Female","Urban Male"))
)
p7<-ggplot(df, aes(x=Grid, y=Values,group=pairs)) +
# Add points, whose color and shape varies with the "variable" column
geom_point(data=df,aes(shape=type),size=2, alpha=0.9) +
geom_line(aes(x=Grid,y=Values),linetype="dashed")+
scale_x_continuous(limits = c(0,8))+
scale_shape_manual(values=c(32,32,1,9,12),
labels=c("","","OLS","2SLS","Local IV"))+
# Provide breakpoints and respective labelings for the x-axis
#scale_x_continuous(breaks=xgrid, labels=c("OLS","MATCH","IPW","DR","2SLS","BAYES"))+
# Lay out plots in a grid fomat, with "measure" used as the vertical
# facet group and "ruralgender" used as the horizontal facet group
facet_grid(measure~ruralgroup) +
# Add horizontal lines at 0
geom_hline(aes(yintercept= 0), linetype="dotdash",alpha=0.5)+
# Add labels. Note that to rename the legend, you have to rename both the
# "shape" and the "color" variables.
labs(title = "", x = "", y="",
shape="") +
# Choose a grayscale palette
scale_color_grey() +
# Remove the default grey background
theme_bw() +
# Customizations. Center plot title, and remove background lines
theme(plot.title = element_text(hjust = 0.5),
panel.spacing.x = unit(0, "lines"),
axis.text.x=element_blank(),
axis.ticks.x=element_blank(),
legend.position="top",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
#
pdf("OtherMethod.pdf",height = 6,width=8.5)
p7
dev.off()
