axis(1, at = seq(0, 1, 0.1),
labels = seq(0, 1, 0.1))
axis(2, at = c(0, 0.1, 0.3, 0.5, 0.7),
labels = c("0", ".1", ".3", ".5", ".7"))
points(z.quantile[index],newz.p[index,1],pch=1,cex=1)
lines(z.quantile,newz.p[,2],type='l',lty=1,lwd=2)
points(z.quantile[index],newz.p[index,2],pch=2,cex=1)
lines(z.quantile,newz.p[,3],type='l',lty=1,lwd=2)
points(z.quantile[index],newz.p[index,3],pch=5,cex=1)
lines(z.quantile,newz.p[,4],type='l',lty=1,lwd=2)
points(z.quantile[index],newz.p[index,4],pch=6,cex=1)
legend("topleft",legend=Subgroup.name,lty=1,pch=c(1,2,5,6),cex=0.7)
dev.off()
setwd("C:/Users/Shuxi ZENG/Dropbox/Third Year/OCP_Revise/Code_Readme/OCP_LIV_JRSSA/Code")
load("Figure4.RData")
pdf("Pos_PS_confidence.pdf",width=8,height = 6)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
dev.off()
load("Figure4.RData")
pdf("Pos_PS_confidence.pdf",width=8,height = 6)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
dev.off()
load("Figure4.RData")
pdf("Pos_PS_confidence.pdf",width=8,height = 6)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
dev.off()
load("Figure4.RData")
pdf("Pos_PS_confidence.pdf",width=8,height = 6)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",ylim=c(0,1),
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
dev.off()
load("Figure4.RData")
pdf("Pos_PS_confidence.pdf",width=8,height = 6)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",ylim=c(0,1),
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
dev.off()
load("Figure4.RData")
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
F3=ecdf(PS_pos_mean[[3]])
lines(F3,col="blue",cex=0.1)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
legend("topleft",lty=1,col=c("black","red","blue","orange"),
legend=c("Rural females","Rural males","Urban females","Urban males"))
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red",lty=3)
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lwd=2,lty=6,cex=0.1)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2,pch=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
points(F2,pch=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2,pch=2)
F2
F2
F2[0]
F2
F2$
type(F2)
class(F2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=6,lwd=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=2,lwd=2)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3,lwd=2)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="",lwd=2)
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=4)
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
lines(F2,lty=3)
lines(F3,lty=4)
lines(F3,lty=5)
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=5)
F3@
summary(F3)
F3
quantile(F2)
summary(F2)
Z=summary(F2)
Z
Z
plot(Z)
summary(F2)
f2
F22
F2
F2$X
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,lty=3)
F3=ecdf(PS_pos_mean[[3]])
lines(F3,lty=5)
F4=ecdf(PS_pos_mean[[4]])
lines(F4,col="orange",cex=0.1)
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
lines(F2,lty=3)
lines(F3,lty=6)
lines(F4,lty=5)
load("Figure6.RData")
group_name=c("rural female","rural male","urban female","urban male")
res_name=c("confidence measure","anxiety measure","desperate measure")
for (res_id in c(1,2,3))
{
for (subgroup in c(1,2,3,4))
{
pdf(paste("SA",res_id,subgroup,"stack.pdf",sep="_"),width=12,height=6)
par(mfrow=c(1,2))
res=SA_prte[[res_id]][,(subgroup-1)*3+c(1,2,3)]
plot(r_grid,res[,1],ylim=range(res),type='o',xaxt='n',
xlab="r",ylab="PRTE",
main="")
axis(1,at=seq(-0.5,0.5,length=11),las=2)
lines(r_grid,res[,2],lty=2)
lines(r_grid,res[,3],lty=2)
abline(h=0,lty=2)
abline(v=0,lty=2)
res=SA_att[[res_id]][,(subgroup-1)*3+c(1,2,3)]
plot(r_grid,res[,1],ylim=range(res),type='o',xaxt='n',
xlab="r",ylab="ATT",
main="")
axis(1,at=seq(-0.5,0.5,length=11),las=2)
lines(r_grid,res[,2],lty=2)
lines(r_grid,res[,3],lty=2)
abline(h=0,lty=2)
abline(v=0,lty=2)
dev.off()
}
}
###Figure 7 plotting
#pdf("Figure7.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression(S_i))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
#dev.off()
###Figure 7 plotting
#pdf("Figure7.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression(S_{i}))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
#dev.off()
###Figure 7 plotting
#pdf("Figure7.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression(S_{i}))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
#dev.off()
###Figure 7 plotting
#pdf("Figure7.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression(S_i))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
#dev.off()
###Figure 7 plotting
#pdf("Figure7.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression('S'[i]))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
#dev.off()
###Figure 7 plotting
pdf("Orahet.pdf")
threshold<-seq(0,1,length=100)
vt<-qnorm(threshold,0,1)
plot(threshold,-0.9*vt,type="l",lty=2,lwd=2,col="grey",ylab="Marginal treatment effect",xlab=expression('S'[i]))
lines(threshold,-0.1*vt,lty=3,lwd=2,col="red")
lines(threshold,-0.3*vt,lty=4,lwd=2,col="blue")
lines(threshold,-0.5*vt,lty=5,lwd=2,col="green")
lines(threshold,-0.7*vt,lty=6,lwd=2)
legend("topright",legend=c("h=-0.1","h=-0.3","h=-0.5","h=-0.7","h=-0.9"),col=c("red","blue","green","black","grey"),lty=c(3,4,5,6,2),lwd=2,cex=0.7)
abline(h=0,lty=2)
dev.off()
##Summary Simulation results
##Draw Figure 8 in the paper.
bias_ols_compare=rep(0,10)
bias_2sls_compare=rep(0,10)
bias_liv1_compare=rep(0,10)
bias_liv2_compare=rep(0,10)
mse_ols_compare=rep(0,10)
mse_2sls_compare=rep(0,10)
mse_liv1_compare=rep(0,10)
mse_liv2_compare=rep(0,10)
var_ols_compare=rep(0,10)
var_2sls_compare=rep(0,10)
var_liv1_compare=rep(0,10)
var_liv2_compare=rep(0,10)
h_grid=seq(0,-.9,length=10)
#collection_simu=rep(list(NA),10)
load("Figure8.RData")
for (i in 1:10)
{
simu_result=collection_simu[[i]]
bias_ols_compare[i]=abs(mean(simu_result[,2]-simu_result[,1]))
bias_2sls_compare[i]=abs(mean(simu_result[,5]-simu_result[,4]))
bias_liv1_compare[i]=abs(mean(simu_result[,3]-simu_result[,1]))
bias_liv2_compare[i]=abs(mean(simu_result[,6]-simu_result[,4]))
mse_ols_compare[i]=sqrt(mean((simu_result[,2]-simu_result[,1])^2))
mse_2sls_compare[i]=sqrt(mean((simu_result[,5]-simu_result[,4])^2))
mse_liv1_compare[i]=sqrt(mean((simu_result[,3]-simu_result[,1])^2))
mse_liv2_compare[i]=sqrt(mean((simu_result[,6]-simu_result[,4])^2))
var_ols_compare[i]=sd(simu_result[,2])
var_2sls_compare[i]=sd(simu_result[,5])
var_liv1_compare[i]=sd(simu_result[,3])
var_liv2_compare[i]=sd(simu_result[,6])
}
pdf("Bias_simu.pdf",width=8,height=6)
plot(abs(h_grid),bias_2sls_compare-bias_liv2_compare,type='o',
ylab="Advantage over absolute bias",
xlab="h",lty=4)
lines(abs(h_grid),bias_ols_compare-bias_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
dev.off()
pdf("MSE_simu.pdf",width=8,height=6)
plot(abs(h_grid),mse_2sls_compare-mse_liv2_compare,type='o',
ylab=expression("Advantage over RMSE"),
xlab="h",lty=4)
lines(abs(h_grid),mse_ols_compare-mse_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
dev.off()
pdf("simu_result.pdf",width=16,height=6)
par(mfrow=c(1,2))
#pdf("Bias_simu.pdf",width=8,height=6)
plot(abs(h_grid),bias_2sls_compare-bias_liv2_compare,type='o',
ylab="Advantage over absolute bias",
xlab="h",lty=4)
lines(abs(h_grid),bias_ols_compare-bias_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
#dev.off()
#pdf("MSE_simu.pdf",width=8,height=6)
plot(abs(h_grid),mse_2sls_compare-mse_liv2_compare,type='o',
ylab=expression("Advantage over RMSE"),
xlab="h",lty=4)
lines(abs(h_grid),mse_ols_compare-mse_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
dev.off()
pdf("simu_result.pdf",width=12,height=6)
par(mfrow=c(1,2))
#pdf("Bias_simu.pdf",width=8,height=6)
plot(abs(h_grid),bias_2sls_compare-bias_liv2_compare,type='o',
ylab="Advantage over absolute bias",
xlab="h",lty=4)
lines(abs(h_grid),bias_ols_compare-bias_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
#dev.off()
#pdf("MSE_simu.pdf",width=8,height=6)
plot(abs(h_grid),mse_2sls_compare-mse_liv2_compare,type='o',
ylab=expression("Advantage over RMSE"),
xlab="h",lty=4)
lines(abs(h_grid),mse_ols_compare-mse_liv1_compare,type='o')
abline(h=0,lty=2)
legend("bottomright",legend=c("OLS-LIV","2SLS-LIV"),lty=c(1,4))
dev.off()
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
load("Figure4.RData")
F1=ecdf(PS_pos_mean[[1]])
plot(F1,
xlab = "Principal strata",
ylab = "Cumulativa distribution function",
main="")
abline(v=c(0,140),lty=2)
F2=ecdf(PS_pos_mean[[2]])
lines(F2,col="red")
